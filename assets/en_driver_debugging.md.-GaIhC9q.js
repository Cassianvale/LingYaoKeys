import{_ as i,c as a,o as n,ag as e}from"./chunks/framework.C48t5LJr.js";const g=JSON.parse('{"title":"Debugging Guide","description":"","frontmatter":{},"headers":[],"relativePath":"en/driver/debugging.md","filePath":"en/driver/debugging.md","lastUpdated":1742393041000}'),l={name:"en/driver/debugging.md"};function t(p,s,h,k,r,d){return n(),a("div",null,s[0]||(s[0]=[e(`<h1 id="debugging-guide" tabindex="-1">Debugging Guide <a class="header-anchor" href="#debugging-guide" aria-label="Permalink to &quot;Debugging Guide&quot;">​</a></h1><h2 id="debugging-tools" tabindex="-1">Debugging Tools <a class="header-anchor" href="#debugging-tools" aria-label="Permalink to &quot;Debugging Tools&quot;">​</a></h2><h3 id="windbg" tabindex="-1">WinDbg <a class="header-anchor" href="#windbg" aria-label="Permalink to &quot;WinDbg&quot;">​</a></h3><ol><li><p>Installation steps:</p><div class="language-powershell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">powershell</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Install WinDbg using winget</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">winget install Microsoft.WinDbg</span></span></code></pre></div></li><li><p>Configure system to generate complete dump:</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>1. Right-click &quot;This PC&quot; -&gt; Properties</span></span>
<span class="line"><span>2. Advanced system settings -&gt; Advanced -&gt; Startup and Recovery -&gt; Settings</span></span>
<span class="line"><span>3. Select &quot;Complete memory dump&quot; under &quot;Write debugging information&quot;</span></span>
<span class="line"><span>4. Ensure &quot;Automatically restart&quot; is checked</span></span></code></pre></div></li><li><p>Analyze with WinDbg:</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>1. Open WinDbg</span></span>
<span class="line"><span>2. File -&gt; Open Crash Dump</span></span>
<span class="line"><span>3. Select C:\\Windows\\MEMORY.DMP or Minidump file</span></span></code></pre></div></li><li><p>Common commands:</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>!analyze -v    # Detailed crash analysis</span></span>
<span class="line"><span>.bugcheck      # Display blue screen code</span></span>
<span class="line"><span>kb             # Display call stack</span></span>
<span class="line"><span>lmvm lykeys    # Display driver information</span></span></code></pre></div></li></ol><h3 id="bluescreenview" tabindex="-1">BlueScreenView <a class="header-anchor" href="#bluescreenview" aria-label="Permalink to &quot;BlueScreenView&quot;">​</a></h3><ol><li><p>Usage steps:</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>1. Download and install BlueScreenView</span></span>
<span class="line"><span>2. Run to automatically display all blue screen records</span></span>
<span class="line"><span>3. View:</span></span>
<span class="line"><span>   - Blue screen code</span></span>
<span class="line"><span>   - Occurrence time</span></span>
<span class="line"><span>   - Driver causing crash</span></span>
<span class="line"><span>   - Call stack information</span></span></code></pre></div></li><li><p>Analysis information:</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>Required information</span></span>
<span class="line"><span>{</span></span>
<span class="line"><span>    1. Basic information:</span></span>
<span class="line"><span>    - Blue screen code (e.g., 0x0000007E)</span></span>
<span class="line"><span>    - Occurrence time</span></span>
<span class="line"><span>    - System version</span></span>
<span class="line"><span>    2. Detailed information:</span></span>
<span class="line"><span>    - Driver name causing crash</span></span>
<span class="line"><span>    - Call stack at crash</span></span>
<span class="line"><span>    - Related memory addresses</span></span>
<span class="line"><span>    3. Environment information:</span></span>
<span class="line"><span>    - System configuration</span></span>
<span class="line"><span>    - Installed drivers</span></span>
<span class="line"><span>    - Hardware information</span></span>
<span class="line"><span>}</span></span></code></pre></div></li></ol><h2 id="driver-verification" tabindex="-1">Driver Verification <a class="header-anchor" href="#driver-verification" aria-label="Permalink to &quot;Driver Verification&quot;">​</a></h2><h3 id="verification-tools" tabindex="-1">Verification Tools <a class="header-anchor" href="#verification-tools" aria-label="Permalink to &quot;Verification Tools&quot;">​</a></h3><ol><li><p>Complete verification (recommended for development testing)</p><div class="language-cmd vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">cmd</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">verifier /flags </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0xFF</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> /driver lykeys.sys</span></span></code></pre></div></li><li><p>Basic verification (recommended for daily testing)</p><div class="language-cmd vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">cmd</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">verifier /standard /driver lykeys.sys</span></span></code></pre></div></li><li><p>Memory verification (for memory issues)</p><div class="language-cmd vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">cmd</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">verifier /flags </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0x5</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> /driver lykeys.sys</span></span></code></pre></div></li><li><p>IRQL verification (for IRQL issues)</p><div class="language-cmd vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">cmd</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">verifier /flags </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0x2</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> /driver lykeys.sys</span></span></code></pre></div></li></ol><h3 id="local-kernel-debugging" tabindex="-1">Local Kernel Debugging <a class="header-anchor" href="#local-kernel-debugging" aria-label="Permalink to &quot;Local Kernel Debugging&quot;">​</a></h3><ol><li><p>Configure debugging:</p><div class="language-cmd vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">cmd</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">bcdedit /debug on</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">bcdedit /dbgsettings local</span></span></code></pre></div></li><li><p>Add detailed logging:</p><div class="language-c vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">c</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">KdPrint</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">((</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Driver State: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">%d</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">, IRQL: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">%d\\n</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, state, </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">KeGetCurrentIrql</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">()));</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">KdPrint</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">((</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Callback Address: 0x</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">%p\\n</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, callback));</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">KdPrint</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">((</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Memory Region: 0x</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">%p</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">, Size: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">%d\\n</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, address, size));</span></span></code></pre></div></li></ol><h2 id="common-issues" tabindex="-1">Common Issues <a class="header-anchor" href="#common-issues" aria-label="Permalink to &quot;Common Issues&quot;">​</a></h2><h3 id="driver-service-issues" tabindex="-1">Driver Service Issues <a class="header-anchor" href="#driver-service-issues" aria-label="Permalink to &quot;Driver Service Issues&quot;">​</a></h3><ol><li><p>Manually stop service:</p><div class="language-cmd vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">cmd</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">sc query lykeys</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">sc stop lykeys</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">sc </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">delete</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> lykeys</span></span></code></pre></div></li><li><p>Quick command:</p><div class="language-cmd vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">cmd</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">@echo off </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&amp;&amp;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> sc query lykeys </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> nul </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">2</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;&amp;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> &amp;&amp;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (echo Service </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">exists</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, stopping... </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&amp;&amp;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> sc stop lykeys </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> nul </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">2</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;&amp;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> &amp;&amp;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> timeout /t </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">2</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> /nobreak </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> nul </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&amp;&amp;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> sc </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">delete</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> lykeys </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> nul </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">2</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;&amp;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> &amp;&amp;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> echo Service deleted successfully </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&amp;&amp;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> exit) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">||</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (echo Service does </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">not</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> exist </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&amp;&amp;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> exit)</span></span></code></pre></div></li></ol><h3 id="driver-signature-issues" tabindex="-1">Driver Signature Issues <a class="header-anchor" href="#driver-signature-issues" aria-label="Permalink to &quot;Driver Signature Issues&quot;">​</a></h3><ol><li><p>Test mode settings:</p><div class="language-cmd vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">cmd</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"># Disable forced driver signing </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&amp;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> test mode </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&amp;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> restart</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">bcdedit /</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">set </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">nointegritychecks on</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">bcdedit /</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">set </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">testsigning on</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">shutdown </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">r </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">t </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0</span></span></code></pre></div></li><li><p>Signature verification:</p><ul><li>Check driver signature certificate</li><li>Verify signature timestamp</li><li>Confirm signature chain integrity</li></ul></li></ol><h2 id="debugging-tips" tabindex="-1">Debugging Tips <a class="header-anchor" href="#debugging-tips" aria-label="Permalink to &quot;Debugging Tips&quot;">​</a></h2><h3 id="logging" tabindex="-1">Logging <a class="header-anchor" href="#logging" aria-label="Permalink to &quot;Logging&quot;">​</a></h3><ol><li><p>Add detailed logs:</p><div class="language-c vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">c</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// Log key operations</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">KdPrint</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">((</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Operation: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">%s\\n</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, operation));</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// Log parameter information</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">KdPrint</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">((</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Parameters: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">%d</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">%d\\n</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, param1, param2));</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// Log error information</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">KdPrint</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">((</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Error: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">%d\\n</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, error));</span></span></code></pre></div></li><li><p>Log analysis:</p><ul><li>Use log analysis tools</li><li>Filter key information</li><li>Track problem root cause</li></ul></li></ol>`,19)]))}const c=i(l,[["render",t]]);export{g as __pageData,c as default};
