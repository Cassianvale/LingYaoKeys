
## windows 下使用 C# 实现驱动级键鼠模拟 

### 驱动级键鼠模拟函数
```C#
[DllImport("DD64.dll")]
static extern int DD_btn(int i);
[DllImport("DD64.dll")]
static extern int DD_mov(int x, int y);
[DllImport("DD64.dll")]
static extern int DD_key(int x, int y);
```

### DD_btn(参数)
功能： 模拟鼠标点击  
参数： 1 =左键按下 ，2 =左键放开  
4 =右键按下 ，8 =右键放开  
16 =中键按下 ，32 =中键放开  
64 =4键按下 ，128 =4键放开  
256 =5键按下 ，512 =5键放开  
例子：模拟鼠标右键 只需要连写(中间可添加延迟)  
`dd_btn(4); dd_btn(8);`

### DD_mov(int x, int y)
功能： 模拟鼠标移动  
参数： (x, y) 以屏幕左上角为原点  
例子： 把鼠标移动到分辨率1920*1080 的屏幕正中间  
`int x = 1920/2 ; int y = 1080/2;`
`DD_mov(x,y) ;`

### DD_movR(int dx, int dy)
功能： 模拟鼠标相对移动  
参数：dx, dy 以当前坐标为原点  
例子：  
把鼠标向左移动10像素  
`DD_movR(-10,0);`

### DD_whl(int whl)
功能: 模拟鼠标滚轮  
参数: 1=前, 2=后  
例子: 向前滚一格, DD_whl(1)  

### DD_key(int ddcode，int flag)
功能： 模拟键盘按键  
参数： 
- ddcode: dd驱动专用键码  
- flag，1=按下，2=放开  
例子:  
单键WIN  
`DD_key(601, 1);`
`DD_key(601, 2);`
组合键：ctrl+alt+del  
`DD_key(600,1);`
`DD_key(602,1);`
`DD_key(706,1);`
`DD_key(706,2);`
`DD_key(602,2);`
`DD_key(600,2);`

### DD_todc(参数)
功能： 转换Windows虚拟键码到dd键码  
参数： Windows虚拟键码  
例子：  
```C#
int ddcode = DD_todc(VK_ESCAPE);
Dim ddcode As int32 = DD_todc(27);
```

### DD_str(char *str)
功能： 直接输入键盘上可见字符和空格  
参数： 字符串, (注意，这个参数不是int32 类型)  
例子： DD_str("MyEmail@aa.bb.cc !@#$")  

## 键码映射表

| 键位        | Code  | 备注        |
| --------- | ----- | --------- |
| ESC       | 100   | 退出键       |
| F1        | 101   | 功能键       |
| F2        | 102   | 功能键       |
| F3        | 103   | 功能键       |
| F4        | 104   | 功能键       |
| F5        | 105   | 功能键       |
| F6        | 106   | 功能键       |
| F7        | 107   | 功能键       |
| F8        | 108   | 功能键       |
| F9        | 109   | 功能键       |
| F10       | 110   | 功能键       |
| F11       | 111   | 功能键       |
| F12       | 112   | 功能键       |
| ~         | 200   | 波浪号       |
| 1         | 201   | 数字键       |
| 2         | 202   | 数字键       |
| 3         | 203   | 数字键       |
| 4         | 204   | 数字键       |
| 5         | 205   | 数字键       |
| 6         | 206   | 数字键       |
| 7         | 207   | 数字键       |
| 8         | 208   | 数字键       |
| 9         | 209   | 数字键       |
| 0         | 210   | 数字键       |
| -         | 211   | 减号        |
| =         | 212   | 等号        |
| \         | 213   | 反斜杠       |
| Backspace | 214   | 退格键       |
| Tab       | 300   | 制表键       |
| Q         | 301   | 字母键       |
| W         | 302   | 字母键       |
| E         | 303   | 字母键       |
| R         | 304   | 字母键       |
| T         | 305   | 字母键       |
| Y         | 306   | 字母键       |
| U         | 307   | 字母键       |
| I         | 308   | 字母键       |
| O         | 309   | 字母键       |
| P         | 310   | 字母键       |
| [         | 311   | 左方括号      |
| ]         | 312   | 右方括号      |
| Enter     | 313   | Enter回车   |
| Caps Lock | 400   | 大写锁定      |
| A         | 401   | 字母键       |
| S         | 402   | 字母键       |
| D         | 403   | 字母键       |
| F         | 404   | 字母键       |
| G         | 405   | 字母键       |
| H         | 406   | 字母键       |
| J         | 407   | 字母键       |
| K         | 408   | 字母键       |
| L         | 409   | 字母键       |
| ;         | 410   | 分号        |
| '         | 411   | 单引号       |
| LShift    | 500   | 左Shift键   |
| Z         | 501   | 字母键       |
| X         | 502   | 字母键       |
| C         | 503   | 字母键       |
| V         | 504   | 字母键       |
| B         | 505   | 字母键       |
| N         | 506   | 字母键       |
| M         | 507   | 字母键       |
| ,         | 508   | 逗号        |
| .         | 509   | 句号        |
| /         | 510   | 斜杠        |
| LShift    | 511   | 右Shift键   |
| LCtrl     | 600   | 左Ctrl键    |
| LWin      | 601   | Windows键  |
| LAlt      | 602   | Alt键      |
| Space     | 603   | 空格键       |
| RAlt      | 604   | 右Alt键     |
| Fn        | 605   | 功能键       |
| Menu      | 606   | 菜单键       |
| RCtrl     | 607   | 右Ctrl键    |
| Print     | 700   | 打印键       |
| Scroll    | 701   | 滚动键       |
| Pause     | 702   | 暂停键       |
| Insert    | 703   | 插入键       |
| Home      | 704   | 主页键       |
| UP        | 705   | 上翻页       |
| DEL       | 706   | 删除键       |
| END       | 707   | 结束键       |
| Down      | 708   | 下翻页       |
| 上         | 709   | 方向键       |
| 左         | 710   | 方向键       |
| 下         | 711   | 方向键       |
| 右         | 712   | 方向键       |
| 0         | 800   | 小键盘区      |
| 1         | 801   | 小键盘区      |
| 2         | 802   | 小键盘区      |
| 3         | 803   | 小键盘区      |
| 4         | 804   | 小键盘区      |
| 5         | 805   | 小键盘区      |
| 6         | 806   | 小键盘区      |
| 7         | 807   | 小键盘区      |
| 8         | 808   | 小键盘区      |
| 9         | 809   | 小键盘区      |
| Num       | 810   | 小键盘区      |
| /         | 811   | 小键盘区      |
| *         | 812   | 小键盘区      |
| -         | 813   | 小键盘区      |
| +         | 814   | 小键盘区      |
| Enter     | 815   | 小键盘回车     |
| .         | 816   | 小键盘小数点    |

## 键码映射链路
1. 用户输入阶段
- 用户在UI上选择或按下按键
- KeyMappingViewModel接收按键输入
- 转换为DDKeyCode枚举值

2. 键码转换验证阶段
- KeyCodeMapping负责Windows虚拟键码和DD键码的双向转换
- 验证DDKeyCode是否有效
- 验证是否与启动或停止热键相同
- 验证是否已存在于按键列表中
- 处理特殊键码映射

3. 驱动调用
- DDDriverService将DDKeyCode转换为DD驱动识别的整数键码
- 调用DD驱动的key函数执行按键操作
- 处理按键按下和释放状态
- 处理鼠标移动和滚轮操作

4. 结果处理
- 驱动返回执行结果
- DDDriverService处理执行状态，通过事件机制通知上层     

5. 状态更新
- ViewModel接收执行状态
- 更新UI状态

6. 显示转换
- DDKeyCodeExtensions 负责将 DDKeyCode 转换为UI显示的文本

